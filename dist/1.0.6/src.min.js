!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.FacetedSearch=t()}}(function(){var t;return function e(t,n,r){function i(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return i(n?n:e)},c,c.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e){var n,r,i;n=t("jquery"),i=t("./token"),r={token:!0},e.exports={get:function(t,e){return null==e&&(e={}),this.fire("get",t,e)},post:function(t,e){return null==e&&(e={}),this.fire("post",t,e)},put:function(t,e){return null==e&&(e={}),this.fire("put",t,e)},poll:function(t){var e,n,r,i;return i=t.url,r=t.testFn,e=t.done,(n=function(t){return function(){var o;return o=t.get({url:i}),o.done(function(t,i,o){return r(t)?e(t,i,o):setTimeout(n,5e3)})}}(this))()},fire:function(t,e,o){var s;return o=n.extend({},r,o),s={type:t,dataType:"json",contentType:"application/json; charset=utf-8",processData:!1,crossDomain:!0},s.beforeSend=o.token&&null!=i.get()?function(){return function(t){return t.setRequestHeader("Authorization",""+i.getType()+" "+i.get())}}(this):function(){return function(){}}(this),n.ajax(n.extend(s,e))}}},{"./token":2,jquery:"D1nrrK"}],2:[function(t,e){var n;n=function(){function t(){}return t.prototype.token=null,t.prototype.set=function(t,e){return this.token=t,null==e&&(e="SimpleAuth"),sessionStorage.setItem("huygens_token_type",e),sessionStorage.setItem("huygens_token",this.token)},t.prototype.getType=function(){return sessionStorage.getItem("huygens_token_type")},t.prototype.get=function(){return null==this.token&&(this.token=sessionStorage.getItem("huygens_token")),this.token},t.prototype.clear=function(){return sessionStorage.removeItem("huygens_token"),sessionStorage.removeItem("huygens_token_type")},t}(),e.exports=new n},{}],3:[function(t,e){var n;n=t("backbone"),e.exports={subscribe:function(t,e){return this.listenTo(n,t,e)},publish:function(){return n.trigger.apply(n,arguments)}}},{backbone:"j6c3vP"}],4:[function(t,e){var n,r;r=t("underscore"),n=function(t){return r.isString(t)&&(t=document.querySelector(t)),{el:t,q:function(t){return n(t)},find:function(t){return n(t)},findAll:function(e){return n(t.querySelectorAll(e))},html:function(e){return null==e?t.innerHTML:1===e.nodeType||11===e.nodeType?(t.innerHTML="",t.appendChild(e)):t.innerHTML=e},hide:function(){return t.style.display="none",this},show:function(e){return null==e&&(e="block"),t.style.display=e,this},toggle:function(e,n){var r;return null==e&&(e="block"),r=t.style.display===e?"none":e,null!=n&&(r=n?e:"none"),t.style.display=r,this},closest:function(e){var n;for(n=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector;t;){if(n.bind(t)(e))return t;t=t.parentNode}},append:function(e){return t.appendChild(e)},prepend:function(e){return t.insertBefore(e,t.firstChild)},position:function(e){var n,r,i;for(null==e&&(e=document.body),n=0,i=0,r=t;null!=r&&r!==e&&!this.hasDescendant(e);)n+=r.offsetLeft,i+=r.offsetTop,r=r.offsetParent;return{left:n,top:i}},hasDescendant:function(e){var n;for(n=e.parentNode;null!=n;){if(n===t)return!0;n=n.parentNode}return!1},boundingBox:function(){var e;return e=this.position(),e.width=t.clientWidth,e.height=t.clientHeight,e.right=e.left+e.width,e.bottom=e.top+e.height,e},insertAfter:function(e){return e.parentNode.insertBefore(t,e.nextSibling)},highlightUntil:function(e,n){return null==n&&(n={}),null==n.highlightClass&&(n.highlightClass="highlight"),null==n.tagName&&(n.tagName="span"),{on:function(){var r,i,o,s,a;for(o=document.createRange(),o.setStartAfter(t),o.setEndBefore(e),r=function(){return function(t){var e,n,r;return n=document.createRange(),n.selectNode(t),r=n.compareBoundaryPoints(Range.START_TO_START,o),e=n.compareBoundaryPoints(Range.END_TO_START,o),-1===r||1===e?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT}}(this),r.acceptNode=r,a=document.createTreeWalker(o.commonAncestorContainer,NodeFilter.SHOW_TEXT,r,!1);a.nextNode();)s=new Range,s.selectNode(a.currentNode),i=document.createElement(n.tagName),i.className=n.highlightClass,s.surroundContents(i);return this},off:function(){var e,r,i,o;for(i=document.querySelectorAll("."+n.highlightClass),o=[],e=0,r=i.length;r>e;e++)t=i[e],t.parentElement.insertBefore(t.firstChild,t),o.push(t.parentElement.removeChild(t));return o}}},hasClass:function(e){return(" "+t.className+" ").indexOf(" "+e+" ")>-1},addClass:function(e){return this.hasClass(e)?void 0:t.className+=" "+e},removeClass:function(e){var n;return n=" "+t.className+" ",n=n.replace(" "+e+" ",""),t.className=n.replace(/^\s+|\s+$/g,"")},toggleClass:function(t){return this.hasClass(t)?this.addClass(t):this.removeClass(t)},inViewport:function(e){var n,r,i;return i=null!=e?e:window,n=null!=e?e:document.documentElement,r=t.getBoundingClientRect(),r.top>=0&&r.left>=0&&r.bottom<=(i.innerHeight||n.clientHeight)&&r.right<=(i.innerWidth||n.clientWidth)},createTreeWalker:function(e,n){var r,i;return null==n&&(n=NodeFilter.SHOW_ELEMENT),i=document.createRange(),i.setStartAfter(t),i.setEndBefore(e),r=function(){return function(t){var e,n,r;return n=document.createRange(),n.selectNode(t),r=n.compareBoundaryPoints(Range.START_TO_START,i),e=n.compareBoundaryPoints(Range.END_TO_START,i),-1===r||1===e?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT}}(this),r.acceptNode=r,document.createTreeWalker(i.commonAncestorContainer,n,r,!1)}}},e.exports=n},{underscore:"lkcZM4"}],5:[function(t,e){var n,r,i={}.hasOwnProperty;n=t("jquery"),r=t("underscore"),e.exports={closest:function(t,e){var n;for(n=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector;t;){if(n.bind(t)(e))return t;t=t.parentNode}},generateID:function(t){var e,n;for(t=null!=t&&t>0?t-1:7,e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=e.charAt(Math.floor(52*Math.random()));t--;)n+=e.charAt(Math.floor(Math.random()*e.length));return n},deepCopy:function(t){var e;return e=Array.isArray(t)?[]:{},n.extend(!0,e,t)},timeoutWithReset:function(){var t;return t=null,function(e,n,r){return null!=t&&(null!=r&&r(),clearTimeout(t)),t=setTimeout(function(){return t=null,n()},e)}}(),highlighter:function(t){var e,r,i;return null==t&&(t={}),e=t.className,i=t.tagName,null==e&&(e="hilite"),null==i&&(i="span"),r=null,{on:function(t){var n,o,s;return s=t.startNode,n=t.endNode,o=document.createRange(),o.setStartAfter(s),o.setEndBefore(n),r=document.createElement(i),r.className=e,r.appendChild(o.extractContents()),o.insertNode(r)},off:function(){return n(r).replaceWith(function(){return n(this).contents()})}}},position:function(t,e){var n,r;for(n=0,r=0;t!==e;)n+=t.offsetLeft,r+=t.offsetTop,t=t.offsetParent;return{left:n,top:r}},boundingBox:function(t){var e;return e=n(t).offset(),e.width=t.clientWidth,e.height=t.clientHeight,e.right=e.left+e.width,e.bottom=e.top+e.height,e},isDescendant:function(t,e){var n;for(n=e.parentNode;null!=n;){if(n===t)return!0;n=n.parentNode}return!1},removeFromArray:function(t,e){var n;return n=t.indexOf(e),t.splice(n,1),t},escapeRegExp:function(t){return t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},flattenObject:function(t,e,n){var o,s;null==e&&(e={}),null==n&&(n="");for(o in t)i.call(t,o)&&(s=t[o],!r.isObject(s)||r.isArray(s)||r.isFunction(s)||s instanceof Backbone.Model||s instanceof Backbone.Collection?e[n+o]=s:this.flattenObject(s,e,n+o+"."));return e},compareJSON:function(t,e){var n,o,s;o={};for(n in t)i.call(t,n)&&(s=t[n],e.hasOwnProperty(n)||(o[n]="removed"));for(n in e)i.call(e,n)&&(s=e[n],t.hasOwnProperty(n)?r.isArray(s)||this.isObjectLiteral(s)?r.isEqual(t[n],e[n])||(o[n]=e[n]):t[n]!==e[n]&&(o[n]=e[n]):o[n]="added");return o},isObjectLiteral:function(t){var e;if(null==t||"object"!=typeof t)return!1;for(e=t;null!==Object.getPrototypeOf(e=Object.getPrototypeOf(e)););return Object.getPrototypeOf(t)===e},getScrollPercentage:function(t){var e,n,r,i,o,s;return r=t.scrollTop,s=t.scrollHeight-t.clientHeight,n=t.scrollLeft,o=t.scrollWidth-t.clientWidth,i=0===s?0:Math.floor(r/s*100),e=0===o?0:Math.floor(n/o*100),{top:i,left:e}},setScrollPercentage:function(t,e){return e.top<5&&(e.top=0),e.top>95&&(e.top=100),t.scrollTop=(t.scrollHeight-t.clientHeight)*e.top/100,t.scrollLeft=(t.scrollWidth-t.clientWidth)*e.left/100},checkCheckboxes:function(t,e,n){var r,i,o,s,a;for(null==t&&(t='input[type="checkbox"]'),null==e&&(e=!0),null==n&&(n=document),i=n.querySelectorAll(t),a=[],o=0,s=i.length;s>o;o++)r=i[o],a.push(r.checked=e);return a},setCursorToEnd:function(t,e){var n,r,i;return i=null!=e?e:window,null==e&&(e=t),e.focus(),n=document.createRange(),n.selectNodeContents(t),n.collapse(!1),r=i.getSelection(),null!=r?(r.removeAllRanges(),r.addRange(n)):void 0},arraySum:function(t){return 0===t.length?0:t.reduce(function(t,e){return e+t})},getAspectRatio:function(t,e,n,r){var i,o;return o=n/t,i=r/e,Math.min(o,i)},hasScrollBar:function(t){return t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth},hasXScrollBar:function(t){return t.scrollWidth>t.clientWidth},hasYScrollBar:function(t){return t.scrollHeight>t.clientHeight}}},{jquery:"D1nrrK",underscore:"lkcZM4"}],6:[function(t,e){var n;n=t("jquery"),e.exports={ucfirst:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},slugify:function(t){var e,n,r,i;for(e="àáäâèéëêìíïîòóöôùúüûñç·/_:;",i="aaaaeeeeiiiioooouuuunc-----",t=t.trim().toLowerCase(),r=t.length;r--;)n=e.indexOf(t[r]),-1!==n&&(t=t.substr(0,r)+i[n]+t.substr(r+1));return t.replace(/[^a-z0-9 -]/g,"").replace(/\s+|\-+/g,"-").replace(/^\-+|\-+$/g,"")},stripTags:function(t){return n("<span />").html(t).text()},onlyNumbers:function(t){return t.replace(/[^\d.]/g,"")},hashCode:function(t){var e,n,r,i,o,s;if(0===t.length)return!1;for(r=0,i=o=0,s=t.length;s>o;i=++o)n=t[i],e=t.charCodeAt(i),r=(r<<5)-r+e,r&=r;return r},insertAt:function(t,e,n){return t.slice(0,n)+e+t.slice(n)}}},{jquery:"D1nrrK"}],7:[function(e,n,r){(function(i){!function(e){if("object"==typeof r)n.exports=e();else if("function"==typeof t&&t.amd)t(e);else{var o;"undefined"!=typeof window?o=window:"undefined"!=typeof i?o=i:"undefined"!=typeof self&&(o=self),o.jade=e()}}(function(){return function t(n,r,i){function o(a,u){if(!r[a]){if(!n[a]){var c="function"==typeof e&&e;if(!u&&c)return c(a,!0);if(s)return s(a,!0);throw new Error("Cannot find module '"+a+"'")}var l=r[a]={exports:{}};n[a][0].call(l.exports,function(t){var e=n[a][1][t];return o(e?e:t)},l,l.exports,t,n,r,i)}return r[a].exports}for(var s="function"==typeof e&&e,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(t,e,n){"use strict";function r(t){return null!=t&&""!==t}function i(t){return Array.isArray(t)?t.map(i).filter(r).join(" "):t}n.merge=function o(t,e){if(1===arguments.length){for(var n=t[0],i=1;i<t.length;i++)n=o(n,t[i]);return n}var s=t["class"],a=e["class"];(s||a)&&(s=s||[],a=a||[],Array.isArray(s)||(s=[s]),Array.isArray(a)||(a=[a]),t["class"]=s.concat(a).filter(r));for(var u in e)"class"!=u&&(t[u]=e[u]);return t},n.joinClasses=i,n.cls=function(t,e){for(var r=[],o=0;o<t.length;o++)r.push(e&&e[o]?n.escape(i([t[o]])):i(t[o]));var s=i(r);return s.length?' class="'+s+'"':""},n.attr=function(t,e,r,i){return"boolean"==typeof e||null==e?e?" "+(i?t:t+'="'+t+'"'):"":0==t.indexOf("data")&&"string"!=typeof e?" "+t+"='"+JSON.stringify(e).replace(/'/g,"&apos;")+"'":r?" "+t+'="'+n.escape(e)+'"':" "+t+'="'+e+'"'},n.attrs=function(t,e){var r=[],o=Object.keys(t);if(o.length)for(var s=0;s<o.length;++s){var a=o[s],u=t[a];"class"==a?(u=i(u))&&r.push(" "+a+'="'+u+'"'):r.push(n.attr(a,u,!1,e))}return r.join("")},n.escape=function(t){var e=String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");return e===""+t?t:e},n.rethrow=function s(e,n,r,i){if(!(e instanceof Error))throw e;if(!("undefined"==typeof window&&n||i))throw e.message+=" on line "+r,e;try{i=i||t("fs").readFileSync(n,"utf8")}catch(o){s(e,null,r)}var a=3,u=i.split("\n"),c=Math.max(r-a,0),l=Math.min(u.length,r+a),a=u.slice(c,l).map(function(t,e){var n=e+c+1;return(n==r?"  > ":"    ")+n+"| "+t}).join("\n");throw e.path=n,e.message=(n||"Jade")+":"+r+"\n"+a+"\n\n"+e.message,e}},{fs:2}],2:[function(){},{}]},{},[1])(1)})}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(t,e){var n,r,i,o,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=t("backbone"),o=t("underscore"),i={Option:t("../models/list.option")},r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.model=i.Option,e.prototype.initialize=function(){return this.comparator=this.strategies.amount_desc},e.prototype.revert=function(){return this.each(function(){return function(t){return t.set("checked",!1,{silent:!0})}}(this)),this.trigger("change")},e.prototype.updateOptions=function(t){return null==t&&(t=[]),this.each(function(){return function(t){return t.set("count",0,{silent:!0})}}(this)),o.each(t,function(t){return function(e){var n;return n=t.get(e.name),null!=n?n.set("count",e.count,{silent:!0}):(n=new i.Option(e),t.add(n))}}(this)),this.sort()},e.prototype.strategies={alpha_asc:function(t){return+!t.get("visible")+ +!!t.get("count")+t.get("name")},alpha_desc:function(t){var e;return e=String.fromCharCode.apply(String,o.map(t.get("name").split(""),function(t){return 65535-t.charCodeAt()})),+!t.get("visible")+ +!!t.get("count")+e},amount_asc:function(t){var e;return e=t.get("visible")?0:1e7,e+ +t.get("count")},amount_desc:function(t){var e;return e=t.get("visible")?-1e7:0,e+-1*+t.get("count")}},e.prototype.orderBy=function(t){return this.comparator=this.strategies[t],this.sort()},e.prototype.setAllVisible=function(){return this.each(function(t){return t.set("visible",!0)}),this.sort()},e}(n.Collection),e.exports=r},{"../models/list.option":16,backbone:"j6c3vP",underscore:"lkcZM4"}],9:[function(t,e){var n,r,i,o,s,a,u,c={}.hasOwnProperty,l=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=t("backbone"),u=t("underscore"),a=t("hilib/src/mixins/pubsub"),r=t("../models/searchresult"),o=t("hilib/src/managers/ajax"),s=t("../config"),i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return l(e,t),e.prototype.model=r,e.prototype.initialize=function(){return u.extend(this,a),this.cachedModels={},this.queryAmount=0,this.on("add",this.setCurrent,this)},e.prototype.clearCache=function(){return this.cachedModels={}},e.prototype.setCurrent=function(t){var e,n;return this.current=t,e=null!=(null!=(n=this.current.options)?n.url:void 0)?"change:cursor":"change:results",this.trigger(e,this.current)},e.prototype.runQuery=function(t,e){var n,r;return null==e&&(e={}),null==e.cache&&(e.cache=!0),this.queryAmount+=1,t.hasOwnProperty("resultRows")&&(r=t.resultRows,delete t.resultRows),n=JSON.stringify(t),e.cache&&this.cachedModels.hasOwnProperty(n)?this.setCurrent(this.cachedModels[n]):this.postQuery(t,function(t){return function(e){return t.getResults(e,function(e){return t.addModel(e,n)})}}(this))},e.prototype.addModel=function(t,e){return this.cachedModels[e]=new this.model(t),this.add(this.cachedModels[e])},e.prototype.moveCursor=function(t){var e;return e="_prev"===t||"_next"===t?this.current.get(t):t,null!=e?this.cachedModels.hasOwnProperty(e)?this.setCurrent(this.cachedModels[e]):this.getResults(e,function(t){return function(n){return t.addModel(n,e)}}(this)):void 0},e.prototype.page=function(t,e){var n,r;return n=s.resultRows*(t-1),r=this.postURL+("?rows="+s.resultRows+"&start="+n),null!=e&&(r+="&database="+e),this.getResults(r,function(t){return function(n){return t.trigger("change:page",new t.model(n),e)}}(this))},e.prototype.postQuery=function(t,e){var n,r;return this.trigger("request"),n={url:s.baseUrl+s.searchPath,data:JSON.stringify(t),dataType:"text"},s.hasOwnProperty("requestOptions")&&u.extend(n,s.requestOptions),r=o.post(n),r.done(function(t){return function(n,r,i){var o;return 201===i.status?(t.postURL=i.getResponseHeader("Location"),o=null!=s.resultRows?t.postURL+"?rows="+s.resultRows:t.postURL,e(o)):void 0}}(this)),r.fail(function(t){return function(e){return 401===e.status&&t.trigger("unauthorized"),console.error("Failed posting FacetedSearch queryOptions to the server!",arguments)}}(this))},e.prototype.getResults=function(t,e){var n;return this.trigger("request"),n=o.get({url:t}),n.done(function(t){return function(n){return e(n),t.trigger("sync")}}(this)),n.fail(function(t){return function(e){return 401===e.status&&t.trigger("unauthorized"),console.error("Failed getting FacetedSearch results from the server!",arguments)}}(this))},e}(n.Collection),e.exports=i},{"../config":10,"../models/searchresult":20,backbone:"j6c3vP","hilib/src/managers/ajax":1,"hilib/src/mixins/pubsub":3,underscore:"lkcZM4"}],10:[function(t,e){e.exports={resultRows:null,baseUrl:"",searchPath:"",textSearch:"advanced",token:null,queryOptions:{},facetTitleMap:{},templates:{},autoSearch:!0}},{}],11:[function(t,e){var n,r,i,o,s,a,u,c,l,p,h,f={}.hasOwnProperty,d=function(t,e){function n(){this.constructor=t}for(var r in e)f.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};r=t("backbone"),n=t("jquery"),r.$=n,h=t("underscore"),i=t("hilib/src/utils/general"),l=t("hilib/src/utils/dom"),c=t("./config"),s=t("./models/query-options"),a=t("./collections/searchresults"),u={TextSearch:t("./views/text-search"),Facets:t("./views/facets")},p=t("../jade/main.jade"),o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return d(e,t),e.prototype.initialize=function(t){var e;return null==t&&(t={}),null!=t.facetViewMap&&(e=h.clone(t.facetViewMap),delete t.facetViewMap),this.extendConfig(t),this.instantiateQueryOptions(),this.instantiateSearchResults(),this.instantiateFacets(e),this.render(),c.development?(this.searchResults.add(JSON.parse(localStorage.getItem("faceted-search-dev-model"))),this.searchResults.cachedModels['{"facetValues":[],"sortParameters":[]}']=this.searchResults.first(),setTimeout(function(t){return function(){return t.$(".overlay").hide()}}(this),100)):void 0},e.prototype.render=function(){return this.$el.html(p()),c.templates.hasOwnProperty("main")&&this.$("form").html(c.templates.main()),this.$(".faceted-search").addClass("search-type-"+c.textSearch),("simple"===c.textSearch||"advanced"===c.textSearch)&&this.renderTextSearch(),this.$(".facets").html(this.facets.el),setTimeout(this.postRender.bind(this),0),this},e.prototype.postRender=function(){return"simple"!==c.textSearch?this.search():void 0},e.prototype.renderTextSearch=function(){return this.textSearch=new u.TextSearch,this.$(".text-search-placeholder").html(this.textSearch.el),this.listenTo(this.textSearch,"change",function(t){return function(e){return t.queryOptions.set(e,{silent:!0})}}(this)),this.listenTo(this.textSearch,"search",this.search)},e.prototype.events=function(){return{"click ul.facets-menu li.collapse-expand":function(t){return this.facets.toggle(t)},"click ul.facets-menu li.reset":"onReset","click ul.facets-menu li.switch button":"onSwitchType"}},e.prototype.onSwitchType=function(t){return t.preventDefault(),c.textSearch="advanced"===c.textSearch?"simple":"advanced",this.$(".faceted-search").toggleClass("search-type-simple"),this.$(".faceted-search").toggleClass("search-type-advanced"),0===this.searchResults.length?this.search():this.update()},e.prototype.onReset=function(t){return t.preventDefault(),this.reset()},e.prototype.destroy=function(){return this.facets.destroy(),this.textSearch.destroy(),this.remove()},e.prototype.extendConfig=function(t){return h.extend(c.facetTitleMap,t.facetTitleMap),delete t.facetTitleMap,h.extend(c,t),-1===["none","simple","advanced"].indexOf(c.textSearch)?c.textSearch="advanced":void 0},e.prototype.instantiateQueryOptions=function(){var t;return t=h.extend(c.queryOptions,c.textSearchOptions),this.queryOptions=new s(t),c.autoSearch?this.listenTo(this.queryOptions,"change",this.search):void 0},e.prototype.instantiateSearchResults=function(){return this.searchResults=new a,this.listenTo(this.searchResults,"change:results",function(t){return function(e){return"simple"!==c.textSearch&&t.update(),t.trigger("change:results",e)}}(this)),this.listenTo(this.searchResults,"change:cursor",function(t){return function(e){return t.trigger("change:results",e)}}(this)),this.listenTo(this.searchResults,"change:page",function(t){return function(e,n){return t.trigger("change:page",e,n)}}(this)),this.listenTo(this.searchResults,"request",this.showLoader),this.listenTo(this.searchResults,"sync",this.hideLoader),this.listenTo(this.searchResults,"unauthorized",function(t){return function(){return t.trigger("unauthorized")}}(this))},e.prototype.instantiateFacets=function(t){return null==t&&(t={}),this.facets=new u.Facets({viewMap:t}),this.listenTo(this.facets,"change",this.queryOptions.set.bind(this.queryOptions))},e.prototype.showLoader=function(){var t,e,n,r,i,o;return i=this.el.querySelector(".overlay"),"block"!==i.style.display?(r=i.children[0],t=this.el.querySelector(".faceted-search"),e=l(t).boundingBox(),i.style.width=e.width+"px",i.style.height=e.height+"px",i.style.display="block",n=e.left+e.width/2-12,r.style.left=n+"px",o=e.top+e.height/2-12,e.height>window.innerHeight&&(o="50vh"),r.style.top=o+"px"):void 0},e.prototype.hideLoader=function(){return this.el.querySelector(".overlay").style.display="none"},e.prototype.update=function(){return 1===this.searchResults.queryAmount?this.facets.render(this.el,this.searchResults.current.get("facets")):this.facets.update(this.searchResults.current.get("facets"))},e.prototype.page=function(t,e){return this.searchResults.page(t,e)},e.prototype.next=function(){return this.searchResults.moveCursor("_next")},e.prototype.prev=function(){return this.searchResults.moveCursor("_prev")},e.prototype.hasNext=function(){return this.searchResults.current.has("_next")},e.prototype.hasPrev=function(){return this.searchResults.current.has("_prev")},e.prototype.sortResultsBy=function(t){return this.queryOptions.set({sort:t})},e.prototype.reset=function(t){return null==t&&(t=!1),null!=this.textSearch&&this.textSearch.reset(),this.facets.reset(),this.queryOptions.reset(),t||this.searchResults.clearCache(),this.search({cache:t})},e.prototype.refresh=function(t){return null==t&&(t={}),Object.keys(t).length>0&&this.set(t,{silent:!0}),this.search({cache:!1})},e.prototype.search=function(t){return null==t&&(t={}),t=h.extend({wait:!0},t),this.searchResults.runQuery(this.queryOptions.attributes,t)},e}(r.View),e.exports=o},{"../jade/main.jade":37,"./collections/searchresults":9,"./config":10,"./models/query-options":17,"./views/facets":21,"./views/text-search":28,backbone:"j6c3vP","hilib/src/utils/dom":4,"hilib/src/utils/general":5,jquery:"D1nrrK",underscore:"lkcZM4"}],12:[function(t,e){var n,r,i={}.hasOwnProperty,o=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};r={Facet:t("./facet")},n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype.set=function(t,n){return"options"===t?n=this.parseOptions(n):t.hasOwnProperty("options")&&(t.options=this.parseOptions(t.options)),e.__super__.set.call(this,t,n)},e.prototype.parseOptions=function(t){var e;return t=null!=(e=this.get("options"))?e:t,1===t.length&&t.push({name:(!JSON.parse(t[0].name)).toString(),count:0}),t},e}(r.Facet),e.exports=n},{"./facet":14}],13:[function(t,e){var n,r,i={}.hasOwnProperty,o=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};r={Facet:t("../models/facet")},n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype.parse=function(t){return t.options=_.map(_.pluck(t.options,"name"),function(t){return t.substr(0,4)}),t.options=_.unique(t.options),t.options.sort(),t},e}(r.Facet),e.exports=n},{"../models/facet":14}],14:[function(t,e){var n,r,i,o={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=t("backbone"),i=t("../config"),r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.idAttribute="name",e.prototype.parse=function(t){return i.facetTitleMap.hasOwnProperty(t.name)?t.title=i.facetTitleMap[t.name]:i.facetTitleMap[t.name]=t.title,t},e}(n.Model),e.exports=r},{"../config":10,backbone:"j6c3vP"}],15:[function(t,e){var n,r,i={}.hasOwnProperty,o=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};r={Facet:t("./facet")},n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return o(e,t),e}(r.Facet),e.exports=n},{"./facet":14}],16:[function(t,e){var n,r,i={}.hasOwnProperty,o=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=t("backbone"),r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype.idAttribute="name",e.prototype.defaults=function(){return{name:"",count:0,total:0,checked:!1,visible:!1}},e.prototype.parse=function(t){return t.total=t.count,t},e}(n.Model),e.exports=r},{backbone:"j6c3vP"}],17:[function(t,e){var n,r,i,o,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=t("backbone"),o=t("underscore"),i=t("../config"),r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.defaults=function(){return{facetValues:[],sortParameters:[]}},e.prototype.initialize=function(t){this.initialAttributes=t},e.prototype.set=function(t,n){var r;return null!=t.facetValue&&(r=o.reject(this.get("facetValues"),function(e){return e.name===t.facetValue.name}),null!=t.facetValue.values?t.facetValue.values.length>0&&r.push(t.facetValue):r.push(t.facetValue),t.facetValues=r,delete t.facetValue),e.__super__.set.call(this,t,n)},e.prototype.reset=function(){return this.clear({silent:!0}),this.set(this.defaults(),{silent:!0}),this.set(this.initialAttributes,{silent:!0})},e}(n.Model),e.exports=r},{"../config":10,backbone:"j6c3vP",underscore:"lkcZM4"}],18:[function(t,e){var n,r,i={}.hasOwnProperty,o=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=t("../models/facet"),r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype.parse=function(t){return e.__super__.parse.apply(this,arguments),t.options={lowerLimit:+(t.options[0].lowerLimit+"").substr(0,4),upperLimit:+(t.options[0].upperLimit+"").substr(0,4)},t},e}(n),e.exports=r},{"../models/facet":14}],19:[function(t,e){var n,r,i,o={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=t("backbone"),i=t("underscore"),r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.defaults=function(){return{term:"*",caseSensitive:!1,fuzzy:!1,title:"Text Search",name:"text_search"}},e.prototype.queryData=function(){var t;return t=i.extend({},this.attributes),delete t.name,delete t.title,t},e}(n.Model),e.exports=r},{backbone:"j6c3vP",underscore:"lkcZM4"}],20:[function(t,e){var n,r,i,o,s,a={}.hasOwnProperty,u=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=t("backbone"),s=t("underscore"),i=t("hilib/src/managers/ajax"),o=t("../config"),r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.prototype.defaults=function(){return{_next:null,_prev:null,ids:[],numFound:null,results:[],rows:null,solrquery:"",sortableFields:[],start:null,term:""}},e}(n.Model),e.exports=r},{"../config":10,backbone:"j6c3vP","hilib/src/managers/ajax":1,underscore:"lkcZM4"}],21:[function(t,e){var n,r,i,o,s,a=function(t,e){return function(){return t.apply(e,arguments)}},u={}.hasOwnProperty,c=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=t("backbone"),s=t("underscore"),o={BOOLEAN:t("./facets/boolean"),DATE:t("./facets/date"),RANGE:t("./facets/range"),LIST:t("./facets/list")},i=t("../config"),r=function(t){function e(){return this.renderFacet=a(this.renderFacet,this),e.__super__.constructor.apply(this,arguments)}return c(e,t),e.prototype.initialize=function(t){return s.extend(o,t.viewMap),this.views={}},e.prototype.render=function(t,e){var n,r,s,a,c,l;if(this.destroyFacets(),i.templates.hasOwnProperty("main")){for(l=[],s=a=0,c=e.length;c>a;s=++a)n=e[s],l.push(o.hasOwnProperty(n.type)?t.querySelector("."+n.name+"-placeholder").appendChild(this.renderFacet(n).el):void 0);return l}r=document.createDocumentFragment();for(s in e)u.call(e,s)&&(n=e[s],o.hasOwnProperty(n.type)?(r.appendChild(this.renderFacet(n).el),r.appendChild(document.createElement("hr"))):console.error("Unknown facetView",n.type));return t.querySelector(".facets").innerHTML="",t.querySelector(".facets").appendChild(r)},e.prototype.renderFacet=function(t){var e,n;return s.isString(t)&&(t=s.findWhere(this.searchResults.first().get("facets"),{name:t})),e=o[t.type],n=this.views[t.name]=new e({attrs:t}),this.listenTo(n,"change",function(t){return function(e,n){return null==n&&(n={}),t.trigger("change",e,n)}}(this)),n},e.prototype.update=function(t){var e,n,r;r=[];for(n in t)u.call(t,n)&&(e=t[n],r.push(this.views.hasOwnProperty(e.name)?this.views[e.name].update(e.options):void 0));return r},e.prototype.reset=function(){var t,e,n,r;n=this.views,r=[];for(e in n)u.call(n,e)&&(t=n[e],r.push(t.hasOwnProperty("reset")?t.reset():void 0));return r},e.prototype.destroyFacets=function(){var t,e,n,r;this.stopListening(),n=this.views,r=[];for(e in n)u.call(n,e)&&(t=n[e],t.destroy(),r.push(delete this.views[e]));return r},e.prototype.destroy=function(){return this.destroyFacets(),this.remove()},e.prototype.toggle=function(t){var e,n,r,i,o,a,u;return t.preventDefault(),n=$(t.currentTarget).find("i.fa"),a=$(t.currentTarget).find("span"),i=n.hasClass("fa-expand"),n.toggleClass("fa-compress"),n.toggleClass("fa-expand"),u=i?"Collapse":"Expand",a.text(""+u+" facets"),e=s.keys(this.views),r=0,(o=function(t){return function(){var n,s;return s=e[r++],n=t.views[s],null!=n?i?n.showBody(function(){return o()}):n.hideBody(function(){return o()}):void 0}}(this))()},e}(n.View),e.exports=r},{"../config":10,"./facets/boolean":22,"./facets/date":23,"./facets/list":24,"./facets/range":27,backbone:"j6c3vP",underscore:"lkcZM4"}],22:[function(t,e){var n,r,i,o,s,a,u,c={}.hasOwnProperty,l=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=t("jquery"),u=t("underscore"),o=t("hilib/src/utils/string"),i={Boolean:t("../../models/boolean")},s={Facet:t("./main")},a=t("../../../jade/facets/boolean.body.jade"),r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)
}return l(e,t),e.prototype.className="facet boolean",e.prototype.initialize=function(t){return e.__super__.initialize.apply(this,arguments),this.model=new i.Boolean(t.attrs,{parse:!0}),this.listenTo(this.model,"change:options",this.render),this.render()},e.prototype.render=function(){var t;return e.__super__.render.apply(this,arguments),t=a(u.extend(this.model.attributes,{ucfirst:o.ucfirst})),this.$(".body").html(t),this.$("header i.fa").remove(),this},e.prototype.events=function(){return u.extend({},e.__super__.events.apply(this,arguments),{"click i":"checkChanged","click label":"checkChanged"})},e.prototype.checkChanged=function(t){var e,r,i,o,s,a;for(e="LABEL"===t.currentTarget.tagName?this.$('i[data-value="'+t.currentTarget.getAttribute("data-value")+'"]'):n(t.currentTarget),e.toggleClass("fa-square-o"),e.toggleClass("fa-check-square-o"),i=e.attr("data-value"),a=this.model.get("options"),o=0,s=a.length;s>o;o++)r=a[o],r.name===i&&(r.checked=e.hasClass("fa-check-square-o"));return this.trigger("change",{facetValue:{name:this.model.get("name"),values:u.map(this.$("i.fa-check-square-o"),function(t){return t.getAttribute("data-value")})}})},e.prototype.update=function(t){return this.model.set("options",t)},e.prototype.reset=function(){return this.render()},e}(s.Facet),e.exports=r},{"../../../jade/facets/boolean.body.jade":29,"../../models/boolean":12,"./main":26,"hilib/src/utils/string":6,jquery:"D1nrrK",underscore:"lkcZM4"}],23:[function(t,e){var n,r,i,o,s,a={}.hasOwnProperty,u=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=t("hilib/src/utils/string"),r={Date:t("../../models/date")},o={Facet:t("./main")},s=t("../../../jade/facets/date.jade"),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.prototype.className="facet date",e.prototype.initialize=function(t){return e.__super__.initialize.apply(this,arguments),this.model=new r.Date(t.attrs,{parse:!0}),this.listenTo(this.model,"change:options",this.render),this.render()},e.prototype.render=function(){var t;return e.__super__.render.apply(this,arguments),t=s(_.extend(this.model.attributes,{ucfirst:i.ucfirst})),this.$(".placeholder").html(t),this},e.prototype.update=function(){},e.prototype.reset=function(){},e}(o.Facet),e.exports=n},{"../../../jade/facets/date.jade":30,"../../models/date":13,"./main":26,"hilib/src/utils/string":6}],24:[function(t,e){var n,r,i,o,s,a,u,c,l,p={}.hasOwnProperty,h=function(t,e){function n(){this.constructor=t}for(var r in e)p.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=t("jquery"),l=t("underscore"),u=t("../../config"),i=t("hilib/src/utils/general"),s={List:t("../../models/list")},r={Options:t("../../collections/list.options")},a={Facet:t("./main"),Options:t("./list.options")},c=t("../../../jade/facets/list.menu.jade"),o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return h(e,t),e.prototype.className="facet list",e.prototype.initialize=function(t){return this.options=t,e.__super__.initialize.apply(this,arguments),this.model=new s.List(this.options.attrs,{parse:!0}),this.collection=new r.Options(this.options.attrs.options,{parse:!0}),this.render()},e.prototype.render=function(){var t;return e.__super__.render.apply(this,arguments),this.$("header .options").length>0&&(u.templates.hasOwnProperty("list.menu")&&(c=u.templates["list.menu"]),t=c({model:this.model.attributes}),this.$("header .options").html(t)),this.optionsView=new a.Options({collection:this.collection,facetName:this.model.get("name")}),this.$(".body").html(this.optionsView.el),this.listenTo(this.optionsView,"filter:finished",this.renderFilteredOptionCount),this.listenTo(this.optionsView,"change",function(t){return function(e){return t.trigger("change",e)}}(this)),this.collection.length<=3&&this.$("header i.openclose").hide(),this},e.prototype.renderFilteredOptionCount=function(){var t,e,n,r;return n=this.collection.filter(function(t){return t.get("visible")}),e=0<(r=n.length)&&21>r?"visible":"hidden",this.$('input[type="checkbox"][name="all"]').css("visibility",e),t=this.collection.filter(function(t){return t.get("visible")}),0===t.length||t.length===this.collection.length?this.$('header .options input[name="filter"]').addClass("nonefound"):this.$('header .options input[name="filter"]').removeClass("nonefound"),this.$("header small.optioncount").html(t.length+" of "+this.collection.length),this},e.prototype.events=function(){return l.extend({},e.__super__.events.apply(this,arguments),{'keyup input[name="filter"]':function(t){return this.optionsView.filterOptions(t.currentTarget.value)},'change header .options input[type="checkbox"][name="all"]':function(t){return this.optionsView.setCheckboxes(t)},"click header .menu i.filter":"toggleFilterMenu","click header .menu i.alpha":"changeOrder","click header .menu i.amount":"changeOrder"})},e.prototype.toggleFilterMenu=function(){var t,e;return e=this.$("header .options"),t=this.$("i.filter"),t.toggleClass("active"),e.slideToggle(150,function(n){return function(){var r;return r=e.find('input[name="filter"]'),t.hasClass("active")?(r.focus(),n.optionsView.appendOptions(!0),n.renderFilteredOptionCount()):(r.val(""),n.collection.setAllVisible())}}(this))},e.prototype.changeOrder=function(t){var e,r,i;return e=n(t.currentTarget),e.hasClass("active")?e.hasClass("alpha")?(e.toggleClass("fa-sort-alpha-desc"),e.toggleClass("fa-sort-alpha-asc")):e.hasClass("amount")&&(e.toggleClass("fa-sort-amount-desc"),e.toggleClass("fa-sort-amount-asc")):(this.$(".active").removeClass("active"),e.addClass("active")),i=e.hasClass("alpha")?"alpha":"amount",r=e.hasClass("fa-sort-"+i+"-desc")?"desc":"asc",this.collection.orderBy(i+"_"+r)},e.prototype.update=function(t){return this.collection.updateOptions(t)},e.prototype.reset=function(){return this.collection.revert()},e}(a.Facet),e.exports=o},{"../../../jade/facets/list.menu.jade":32,"../../collections/list.options":8,"../../config":10,"../../models/list":15,"./list.options":25,"./main":26,"hilib/src/utils/general":5,jquery:"D1nrrK",underscore:"lkcZM4"}],25:[function(t,e){var n,r,i,o,s,a,u,c,l,p=function(t,e){return function(){return t.apply(e,arguments)}},h={}.hasOwnProperty,f=function(t,e){function n(){this.constructor=t}for(var r in e)h.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};r=t("backbone"),n=t("jquery"),l=t("underscore"),i=t("hilib/src/utils/general"),u=t("../../config"),s={List:t("../../models/list")},a=t("../../../jade/facets/list.body.jade"),c=t("../../../jade/facets/list.option.jade"),o=function(t){function e(){return this.triggerChange=p(this.triggerChange,this),e.__super__.constructor.apply(this,arguments)}return f(e,t),e.prototype.className="container",e.prototype.initialize=function(t){return this.options=t,this.showingCursor=0,this.showingIncrement=50,this.listenTo(this.collection,"sort",function(t){return function(){return t.rerender()}}(this)),u.templates.hasOwnProperty("list.option")&&(c=u.templates["list.option"]),this.render()},e.prototype.render=function(){return u.templates.hasOwnProperty("list.body")&&(a=u.templates["list.body"]),this.$el.html(a({facetName:this.options.facetName})),this.appendOptions(),this},e.prototype.rerender=function(){var t,e,n,r;for(n="",t=0,e=this.collection.at(t),r=e.get("visible");r;)n+=c({option:e}),t+=1,e=this.collection.at(t),r=null!=e&&e.get("visible")?!0:!1;return this.$("ul").html(n)},e.prototype.appendOptions=function(t){var e,n;for(null==t&&(t=!1),t&&(this.showingIncrement=this.collection.length),n="";this.showingCursor<this.showingIncrement&&this.showingCursor<this.collection.length;)e=this.collection.at(this.showingCursor),e.set("visible",!0),n+=c({option:e}),this.showingCursor=this.showingCursor+1;return this.$("ul").append(n)},e.prototype.renderAll=function(){return this.appendOptions(!0)},e.prototype.events=function(){return{"click li":"checkChanged",scroll:"onScroll"}},e.prototype.onScroll=function(t){var e,n;return this.showingCursor<this.collection.length&&(e=t.currentTarget,n=e.scrollTop/e.scrollHeight,n>this.showingCursor/2/this.collection.length)?(this.showingIncrement+=this.showingIncrement,this.appendOptions()):void 0},e.prototype.checkChanged=function(t){var e,r,o,s;return e=n(t.currentTarget),o=e.attr("data-value"),r=e.find("i.checked"),s=e.find("i.unchecked"),r.is(":visible")?(r.hide(),s.css("display","inline-block")):(r.css("display","inline-block"),s.hide()),this.collection.get(o).set("checked",e.find("i.checked").is(":visible")),0!==this.$("i.checked").length&&u.autoSearch?i.timeoutWithReset(1e3,function(t){return function(){return t.triggerChange()}}(this)):this.triggerChange()},e.prototype.triggerChange=function(t){var e;return null==t&&(e=this.collection.filter(function(t){return t.get("checked")}),t=l.map(e,function(t){return t.get("name")})),this.trigger("change",{facetValue:{name:this.options.facetName,values:t}})},e.prototype.filterOptions=function(t){return this.collection.map(function(e){var n;return n=new RegExp(t,"i"),e.set("visible",n.test(e.id))}),this.collection.sort(),this.trigger("filter:finished")},e.prototype.setCheckboxes=function(t){var e,n,r,i,o;for(r=this.collection.filter(function(t){return t.get("visible")}),i=0,o=r.length;o>i;i++)e=r[i],e.set("checked",t.currentTarget.checked);return n=l.map(r,function(t){return t.get("name")}),this.triggerChange(n)},e}(r.View),e.exports=o},{"../../../jade/facets/list.body.jade":31,"../../../jade/facets/list.option.jade":33,"../../config":10,"../../models/list":15,backbone:"j6c3vP","hilib/src/utils/general":5,jquery:"D1nrrK",underscore:"lkcZM4"}],26:[function(t,e){var n,r,i,o,s,a,u={}.hasOwnProperty,c=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};r=t("backbone"),n=t("jquery"),a=t("underscore"),o=t("../../config"),s=t("../../../jade/facets/main.jade"),i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return c(e,t),e.prototype.render=function(){return o.templates.hasOwnProperty("facets.main")&&(s=o.templates["facets.main"]),this.$el.html(s(this.model.attributes)),this},e.prototype.events=function(){return{"click h3":"toggleBody"}},e.prototype.toggleBody=function(t){var e;return e=this.$(".body").is(":visible")?this.hideBody:this.showBody,a.isFunction(t)?e.call(this,t):e.call(this)},e.prototype.hideMenu=function(){var t;return t=this.$("header i.openclose"),t.addClass("fa-plus-square-o"),t.removeClass("fa-minus-square-o"),this.$("header .options").slideUp(150)},e.prototype.hideBody=function(t){return this.hideMenu(),this.$(".body").slideUp(100,function(e){return function(){return null!=t&&t(),e.$("header i.fa").fadeOut(100)}}(this))},e.prototype.showBody=function(t){return this.$(".body").slideDown(100,function(e){return function(){return null!=t&&t(),e.$("header i.fa").fadeIn(100)}}(this))},e.prototype.destroy=function(){return this.remove()},e.prototype.update=function(){},e.prototype.reset=function(){},e}(r.View),e.exports=i},{"../../../jade/facets/main.jade":34,"../../config":10,backbone:"j6c3vP",jquery:"D1nrrK",underscore:"lkcZM4"}],27:[function(t,e){var n,r,i,o,s,a,u,c,l={}.hasOwnProperty,p=function(t,e){function n(){this.constructor=t}for(var r in e)l.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=t("jquery"),c=t("underscore"),a=t("../../config"),r={Range:t("../../models/range")},o={Facet:t("./main")},s=t("../../../jade/facets/range.body.jade"),u=12,i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return p(e,t),e.prototype.className="facet range",e.prototype.initialize=function(t){return e.__super__.initialize.apply(this,arguments),this.draggingMin=!1,this.dragginMax=!1,this.model=new r.Range(t.attrs,{parse:!0}),this.listenTo(this.model,"change:options",this.render),this.render()},e.prototype.render=function(){var t;return e.__super__.render.apply(this,arguments),a.templates.hasOwnProperty("range.body")&&(s=a.templates["range.body"]),t=s(this.model.attributes),this.$(".body").html(t),this.$("header .menu").hide(),setTimeout(function(t){return function(){return t.postRender()}}(this),0),this.$el.mouseleave(function(t){return function(){return t.stopDragging()}}(this)),this},e.prototype.postRender=function(){var t;return this.$minHandle=this.$(".min-handle"),this.$maxHandle=this.$(".max-handle"),this.$minValue=this.$(".min-value"),this.$maxValue=this.$(".max-value"),this.$bar=this.$(".bar"),t=this.$(".slider"),this.sliderWidth=t.width(),this.sliderLeft=t.offset().left,this.minHandleLeft=u/-2,this.maxHandleLeft=this.sliderWidth-u/2,this.$maxHandle.css("left",this.maxHandleLeft)},e.prototype.events=function(){return{"mousedown .max-handle":"startDragging","mousedown .min-handle":"startDragging",mouseup:"stopDragging",mousemove:"drag","click .slider":"moveHandle","click button":"doSearch"}},e.prototype.doSearch=function(t){return t.preventDefault(),this.triggerChange()},e.prototype.triggerChange=function(t){var e;return null==t&&(t={}),e={facetValue:{name:this.model.get("name"),lowerLimit:+(this.$minValue.html()+"0101"),upperLimit:+(this.$maxValue.html()+"1231")}},this.trigger("change",e,t)},e.prototype.moveHandle=function(t){var e;if(t.target===this.el.querySelector(".slider")||t.target===this.el.querySelector(".bar"))return e=t.clientX-this.sliderLeft,Math.abs(this.$minHandle.position().left-e)<Math.abs(this.$maxHandle.position().left-e)?(this.$minHandle.css("left",e-u/2),this.$bar.css("left",e),this.updateValue(this.$minValue,e)):(this.$maxHandle.css("left",e-u/2),this.$bar.css("right",this.sliderWidth-e),this.updateValue(this.$maxValue,e))},e.prototype.startDragging=function(t){var e;return e=n(t.currentTarget),e.hasClass("max-handle")?(this.draggingMax=!0,this.$minHandle.css("z-index",10)):e.hasClass("min-handle")&&(this.draggingMin=!0,this.$maxHandle.css("z-index",10)),e.css("z-index",11)},e.prototype.stopDragging=function(){var t,e,n,r;return this.draggingMin=!1,this.draggingMax=!1,r=this.$minValue[0].getBoundingClientRect(),n=this.$maxValue[0].getBoundingClientRect(),r.right<n.left||r.left>n.right||r.bottom<n.top||r.top>n.bottom?(this.$minValue.css("opacity",1),this.$maxValue.css("opacity",1),this.$(".single-value").hide()):(this.$minValue.css("opacity",0),this.$maxValue.css("opacity",0),this.$(".single-value").show(),t=this.minHandleLeft+(this.maxHandleLeft-this.minHandleLeft)/2,e=t-this.$(".single-value").width()/2+6,this.sliderWidth-e<this.$(".single-value").width()&&(e=this.sliderWidth-this.$(".single-value").width()+18),this.$(".single-value").css("left",e))},e.prototype.drag=function(t){var e;return this.draggingMin&&(e=t.clientX-this.sliderLeft,this.minHandleLeft=e-u/2,e>-1&&e<=this.sliderWidth&&this.maxHandleLeft>this.minHandleLeft&&(this.$minHandle.css("left",this.minHandleLeft),this.$bar.css("left",e),this.updateValue("minValue",e))),this.draggingMax&&(e=t.clientX-this.sliderLeft,this.maxHandleLeft=e-u/2,e>-1&&e<=this.sliderWidth&&this.maxHandleLeft>this.minHandleLeft)?(this.$maxHandle.css("left",this.maxHandleLeft),this.$bar.css("right",this.sliderWidth-e),this.updateValue("maxValue",e)):void 0},e.prototype.updateValue=function(t,e){var n,r,i,o,s;return this.$("button").show(),i=this.model.get("options").lowerLimit,o=this.model.get("options").upperLimit,s=Math.floor(e/this.sliderWidth*(o-i)+i),n="minValue"===t?this.$minValue:this.$maxValue,n.html(s),r="minValue"===t?""+s+" - "+this.$maxValue.html():""+this.$minValue.html()+" - "+s,this.$(".single-value").html(r),a.autoSearch?void 0:this.triggerChange({silent:!0})},e.prototype.getLeftPosFromYear=function(t){var e,n,r;return n=this.model.get("options").lowerLimit,r=this.model.get("options").upperLimit,e=(t-n)/(r-n)*this.sliderWidth,Math.floor(e)},e.prototype.setMinValue=function(t){var e;return e=this.getLeftPosFromYear(t),this.$minHandle.css("left",e),this.$minValue.html(t),this.$bar.css("left",e),this.minHandleLeft=e-u/2},e.prototype.setMaxValue=function(t){var e;return e=this.getLeftPosFromYear(t),this.$maxHandle.css("left",e),this.$maxValue.html(t),this.$bar.css("right",this.sliderWidth-e),this.maxHandleLeft=e-u/2},e.prototype.update=function(t){return c.isArray(t)&&(t=t[0]),this.setMinValue(+(t.lowerLimit+"").substr(0,4)),this.setMaxValue(+(t.upperLimit+"").substr(0,4)),this.$("button").hide()},e}(o.Facet),e.exports=i},{"../../../jade/facets/range.body.jade":35,"../../config":10,"../../models/range":18,"./main":26,jquery:"D1nrrK",underscore:"lkcZM4"}],28:[function(t,e){var n,r,i,o,s,a,u,c={}.hasOwnProperty,l=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=t("backbone"),u=t("underscore"),s=t("hilib/src/utils/dom"),o=t("../config"),r={Search:t("../models/search")},a=t("../../jade/facets/text-search.jade"),i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return l(e,t),e.prototype.className="text-search",e.prototype.initialize=function(){return this.reset()},e.prototype.setModel=function(){return null!=this.model&&this.stopListening(this.model),this.model=new r.Search(o.textSearchOptions)},e.prototype.render=function(){return o.templates.hasOwnProperty("search")&&(a=o.templates.search),this.$el.html(a({model:this.model})),this},e.prototype.events=function(){return{"click i.fa-search":"search",'keyup input[name="search"]':"onKeyUp",'focus input[name="search"]':function(){return this.$(".body .menu").slideDown(150)},"click .menu .fa-times":function(){return this.$(".body .menu").slideUp(150)},'change input[type="checkbox"]':"checkboxChanged"}},e.prototype.onKeyUp=function(t){return this.model.get("term")!==t.currentTarget.value&&(this.model.set({term:t.currentTarget.value}),this.updateQueryModel()),13===t.keyCode?(t.preventDefault(),this.search(t)):void 0},e.prototype.checkboxChanged=function(t){var e,n,r,i,o,s;if(e=t.currentTarget.getAttribute("data-attr"))"searchInTranscriptions"===e&&this.$("ul.textlayers").toggle(t.currentTarget.checked),this.model.set(e,t.currentTarget.checked);else if(e=t.currentTarget.getAttribute("data-attr-array")){for(r=[],s=this.el.querySelectorAll('[data-attr-array="'+e+'"]'),i=0,o=s.length;o>i;i++)n=s[i],n.checked&&r.push(n.getAttribute("data-value"));this.model.set(e,r)}return this.updateQueryModel()},e.prototype.search=function(t){return t.preventDefault(),this.trigger("search")},e.prototype.updateQueryModel=function(){return this.trigger("change",this.model.queryData())},e.prototype.reset=function(){return this.setModel(),this.render()},e.prototype.destroy=function(){return this.remove()},e}(n.View),e.exports=i},{"../../jade/facets/text-search.jade":36,"../config":10,"../models/search":19,backbone:"j6c3vP","hilib/src/utils/dom":4,underscore:"lkcZM4"}],29:[function(t,e){var n=t("jade/runtime");e.exports=function(t){var e,r=[],i=t||{};return function(t,i){r.push("<ul>"),function(){var o=t;if("number"==typeof o.length)for(var s=0,a=o.length;a>s;s++){var u=o[s];r.push('<li><div class="row span6"><div class="cell span5"><i'+n.attr("data-value",u.name,!0,!1)+n.cls([u.checked?"fa fa-check-square-o":"fa fa-square-o"],[!0])+"></i><label"+n.attr("data-value",u.name,!0,!1)+">"+n.escape(null==(e=i(u.name))?"":e)+'</label></div><div class="cell span1 alignright"><div class="count">'+n.escape(null==(e=u.count)?"":e)+"</div></div></div></li>")}else{var a=0;for(var s in o){a++;var u=o[s];r.push('<li><div class="row span6"><div class="cell span5"><i'+n.attr("data-value",u.name,!0,!1)+n.cls([u.checked?"fa fa-check-square-o":"fa fa-square-o"],[!0])+"></i><label"+n.attr("data-value",u.name,!0,!1)+">"+n.escape(null==(e=i(u.name))?"":e)+'</label></div><div class="cell span1 alignright"><div class="count">'+n.escape(null==(e=u.count)?"":e)+"</div></div></div></li>")}}}.call(this),r.push("</ul>")}("options"in i?i.options:"undefined"!=typeof options?options:void 0,"ucfirst"in i?i.ucfirst:"undefined"!=typeof ucfirst?ucfirst:void 0),r.join("")}},{"jade/runtime":7}],30:[function(t,e){var n=t("jade/runtime");e.exports=function(t){var e,r=[],i=t||{};return function(t,i,o){r.push("<header><h3"+n.attr("data-name",t,!0,!1)+">"+n.escape(null==(e=i)?"":e)+'</h3></header><div class="body"><label>From:</label><select>'),function(){var t=o;if("number"==typeof t.length)for(var i=0,s=t.length;s>i;i++){var a=t[i];r.push("<option>"+n.escape(null==(e=a)?"":e)+"</option>")}else{var s=0;for(var i in t){s++;var a=t[i];r.push("<option>"+n.escape(null==(e=a)?"":e)+"</option>")}}}.call(this),r.push("</select><label>To:</label><select>"),function(){var t=o.reverse();if("number"==typeof t.length)for(var i=0,s=t.length;s>i;i++){var a=t[i];r.push("<option>"+n.escape(null==(e=a)?"":e)+"</option>")}else{var s=0;for(var i in t){s++;var a=t[i];r.push("<option>"+n.escape(null==(e=a)?"":e)+"</option>")}}}.call(this),r.push("</select></div>")}("name"in i?i.name:"undefined"!=typeof name?name:void 0,"title"in i?i.title:"undefined"!=typeof title?title:void 0,"options"in i?i.options:"undefined"!=typeof options?options:void 0),r.join("")}},{"jade/runtime":7}],31:[function(t,e){t("jade/runtime");e.exports=function(){var t=[];return t.push("<ul></ul>"),t.join("")}},{"jade/runtime":7}],32:[function(t,e){t("jade/runtime");e.exports=function(){var t=[];return t.push('<input type="checkbox" name="all"/><input type="text" name="filter"/><small class="optioncount"></small>'),t.join("")}},{"jade/runtime":7}],33:[function(t,e){var n=t("jade/runtime");e.exports=function(t){var e,r=[],i=t||{};return function(t){r.push("<li"+n.attr("data-count",t.get("count"),!0,!1)+n.attr("data-value",t.id,!0,!1)+"><i"+n.attr("data-value",t.id,!0,!1)+n.cls(["unchecked","fa","fa-square-o",t.get("checked")?"hidden":"visible"],[null,null,null,!0])+"></i><i"+n.attr("data-value",t.id,!0,!1)+n.cls(["checked","fa","fa-check-square-o",t.get("checked")?"visible":"hidden"],[null,null,null,!0])+"></i><label"+n.attr("data-value",t.id,!0,!1)+">"+(null==(e=":empty"===t.id?"<em>(empty)</em>":t.id)?"":e)+'</label><div class="count">'+n.escape(null==(e=t.get(0===t.get("count")?"total":"count"))?"":e)+"</div></li>")}("option"in i?i.option:"undefined"!=typeof option?option:void 0),r.join("")}},{"jade/runtime":7}],34:[function(t,e){var n=t("jade/runtime");e.exports=function(t){var e,r=[],i=t||{};return function(t,i){r.push('<div class="placeholder pad3"><header><h3'+n.attr("data-name",t,!0,!1)+">"+n.escape(null==(e=i)?"":e)+'</h3><div class="menu"><i title="Filter options" class="filter fa fa-filter"></i><i title="Sort alphabetically" class="alpha fa fa-sort-alpha-asc"></i><i title="Sort numerically" class="amount active fa fa-sort-amount-desc"></i></div><div class="options"></div></header><div class="body"></div></div>')}("name"in i?i.name:"undefined"!=typeof name?name:void 0,"title"in i?i.title:"undefined"!=typeof title?title:void 0),r.join("")}},{"jade/runtime":7}],35:[function(t,e){var n=t("jade/runtime");e.exports=function(t){var e,r=[],i=t||{};return function(t){r.push('<div class="slider"><div class="min-handle"></div><div class="max-handle"></div><div class="bar">&nbsp;</div><div class="min-value">'+n.escape(null==(e=t.lowerLimit)?"":e)+'</div><div class="max-value">'+n.escape(null==(e=t.upperLimit)?"":e)+"</div><button>Search?</button></div>")}("options"in i?i.options:"undefined"!=typeof options?options:void 0),r.join("")}},{"jade/runtime":7}],36:[function(t,e){var n=t("jade/runtime");e.exports=function(t){var e,r=[],i=t||{};return function(t){r.push('<div class="placeholder pad3"><div class="body"><div class="search-input"><input type="text" name="search"/><i class="fa fa-search"></i></div><div class="menu"><i class="fa fa-times"></i><div class="row-1"><div class="cell-1"><input id="cb_casesensitive" type="checkbox" name="cb_casesensitive" data-attr="caseSensitive"/><label for="cb_casesensitive">Match case</label></div><div class="cell-2"><input id="cb_fuzzy" type="checkbox" name="cb_fuzzy" data-attr="fuzzy"/><label for="cb_fuzzy">Fuzzy</label></div></div><div class="row-2">'),(t.has("searchInAnnotations")||t.has("searchInTranscriptions"))&&(r.push('<div class="cell-1"><h4>Search in:</h4><ul class="searchins">'),t.has("searchInTranscriptions")&&r.push('<li class="searchin"><input id="cb_searchin_transcriptions" type="checkbox" data-attr="searchInTranscriptions"'+n.attr("checked",t.get("searchInTranscriptions"),!0,!1)+'/><label for="cb_searchin_transcriptions">Transcriptions</label></li>'),t.has("searchInAnnotations")&&r.push('<li class="searchin"><input id="cb_searchin_annotations" type="checkbox" data-attr="searchInAnnotations"'+n.attr("checked",t.get("searchInAnnotations"),!0,!1)+'/><label for="cb_searchin_annotations">Annotations</label></li>'),r.push("</ul></div>")),t.has("textLayers")&&(r.push('<div class="cell-1"><h4>Textlayers:</h4><ul class="textlayers">'),function(){var i=t.get("textLayers");if("number"==typeof i.length)for(var o=0,s=i.length;s>o;o++){var a=i[o];r.push('<li class="textlayer"><input'+n.attr("id","cb_textlayer"+a,!0,!1)+' type="checkbox" data-attr-array="textLayers"'+n.attr("data-value",a,!0,!1)+' checked="checked"/><label'+n.attr("for","cb_textlayer"+a,!0,!1)+">"+n.escape(null==(e=a)?"":e)+"</label></li>")}else{var s=0;for(var o in i){s++;var a=i[o];r.push('<li class="textlayer"><input'+n.attr("id","cb_textlayer"+a,!0,!1)+' type="checkbox" data-attr-array="textLayers"'+n.attr("data-value",a,!0,!1)+' checked="checked"/><label'+n.attr("for","cb_textlayer"+a,!0,!1)+">"+n.escape(null==(e=a)?"":e)+"</label></li>")}}}.call(this),r.push("</ul></div>")),r.push("</div></div></div></div>")}("model"in i?i.model:"undefined"!=typeof model?model:void 0),r.join("")}},{"jade/runtime":7}],37:[function(t,e){t("jade/runtime");e.exports=function(){var t=[];return t.push('<div class="overlay"><div><i class="fa fa-spinner fa-spin fa-2x"></i></div></div><div class="faceted-search"><form><div class="text-search-placeholder"></div><ul class="facets-menu"><li class="reset"><button><i class="fa fa-refresh"></i><span>Reset search</span></button></li><li class="switch"><button><i class="fa fa-angle-double-down"></i><span>Switch to</span></button></li><li class="collapse-expand"><button><i class="fa fa-compress"></i><span>Collapse facets</span></button></li></ul><div class="facets"><div class="loader"><h4>Loading search...</h4><br/><i class="fa fa-spinner fa-spin fa-2x"></i></div></div></form></div>'),t.join("")}},{"jade/runtime":7}]},{},[11])(11)});